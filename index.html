<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‹±æ–‡éŠæˆ²å¤§é›œç‡´ï¼šå®Œæ•´ç‰ˆ</title>
    <!-- è¼‰å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        /* å®šç¾©å¯æ„›çš„å¡é€šå­—é«”ï¼Œä½¿ç”¨ Inter æ­é…åœ“è§’å’Œç²—é«”ç‡Ÿé€ ç«¥è¶£æ„Ÿ */
        .game-font {
            font-family: 'Inter', sans-serif;
        }

        /* æ¸¸æ¨™é–ƒçˆå‹•ç•« */
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }
        .cursor {
            animation: blink 1s step-end infinite;
        }

        /* æŒ‰éˆ•åŸºç¤æ¨£å¼ */
        .key-btn {
            height: 60px; /* Base height */
            transition: all 0.1s;
        }
        .shadow-cute {
            box-shadow: 0 4px 0 0 #D1A3A3;
        }
        .key-btn:active {
            box-shadow: 0 2px 0 0 #D1A3A3;
            transform: translateY(2px);
        }

        /* éŠæˆ²å¡ç‰‡æ¨£å¼ - Dino Egg Match */
        .dino-card {
            height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%; /* è›‹å½¢æŒ‰éˆ• */
            border: 4px solid #F0B5C2;
            background-color: #FFEC99;
            cursor: pointer;
            transition: all 0.5s ease;
            transform-style: preserve-3d;
            position: relative;
        }
        .dino-card.flipped {
            transform: rotateY(180deg);
        }
        .dino-card-inner {
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            backface-visibility: hidden;
            border-radius: 50%;
            font-size: 1.5rem;
            font-weight: bold;
        }
        .dino-card-front {
            background-color: #BDE0FE; /* è›‹æ®¼è— */
            color: #1E40AF;
        }
        .dino-card-back {
            background-color: #F8F8F8; /* å…§å®¹ç™½ */
            color: #333;
            transform: rotateY(180deg);
        }
        .dino-card.matched {
            background-color: #90EE90;
            border-color: #3CB371;
            cursor: default;
        }

        /* Robot Puzzle (æ‹–æ›³ç›®æ¨™æ¨£å¼) */
        .robot-target {
            min-height: 80px;
            width: 80px;
            border: 3px dashed #7B68EE;
            background-color: #E6E6FA;
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        .robot-target.filled {
            border: 3px solid #3CB371;
            background-color: #90EE90;
            cursor: pointer;
        }
        .robot-part {
            background-color: #FFD700; /* é‡‘å±¬é»ƒ */
            color: #333;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: grab;
            box-shadow: 0 4px 0 0 #B8860B;
            transition: all 0.1s;
        }
        .robot-part:active {
            box-shadow: 0 1px 0 0 #B8860B;
            transform: translateY(3px);
        }
        
        /* Superhero Action æ¨£å¼ */
        .superhero-option {
            background-color: #BDE0FE;
            color: #1E40AF;
            font-weight: bold;
            box-shadow: 0 4px 0 0 #87CEEB;
        }

        /* Grammar Parking Lot æ¨£å¼ */
        .parking-spot {
            background-color: #F0F8FF;
            border: 2px solid #ADD8E6;
            border-radius: 8px;
            padding: 10px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 2px 0 0 #87CEEB;
        }
        .parking-spot.correct {
            background-color: #90EE90;
            border-color: #3CB371;
        }
        .car-anim {
            transition: transform 1s ease-in-out;
        }

        /* Who's Lying? (Game 5) æ¨£å¼ */
        @keyframes shake {
            0%, 100% { transform: translateX(0) scale(1.0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px) scale(1.02); }
            20%, 40%, 60%, 80% { transform: translateX(5px) scale(1.02); }
        }
        .shaking {
            animation: shake 0.5s ease-in-out;
        }

        @keyframes tongue {
            0% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(15px); opacity: 1; }
        }
        .tongue-container {
             position: absolute;
             bottom: 0px;
             left: 50%;
             transform: translateX(-50%);
             z-index: 10;
        }
        .tongue-out {
             display: inline-block;
             animation: tongue 0.5s forwards;
             color: #FF4500;
             font-size: 2rem;
        }

    </style>

    <script>
        // è¨­å®š Tailwind é…ç½®, ä½¿ç”¨æŸ”å’Œå¯æ„›çš„é¦¬å¡é¾é…è‰²
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary-pink': '#FFC7C7',      // ä¸»é¡Œç²‰ (æŸ”å’Œå¯æ„›)
                        'secondary-blue': '#BDE0FE',    // è¼”åŠ©è—
                        'accent-yellow': '#FFEC99',     // å¼·èª¿é»ƒ
                        'background-light': '#F8F8F8',  // æ·ºèƒŒæ™¯
                        'keyboard-bg': '#FFF5D6',       // éµç›¤å€å¡ŠèƒŒæ™¯
                    },
                    boxShadow: {
                        'cute': '0 4px 0 0 #D1A3A3',    // æŒ‰éˆ•ç«‹é«”é™°å½±
                        'key-active': '0 2px 0 0 #D1A3A3', // æŒ‰ä¸‹æ™‚çš„é™°å½±
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-background-light min-h-screen game-font flex flex-col items-center p-4">

    <!-- è¨Šæ¯æç¤ºæ¡† -->
    <div id="message-box" class="fixed top-4 right-4 bg-red-500 text-white p-3 rounded-lg shadow-xl z-50 transition-opacity duration-300 hidden">
        <p id="message-content"></p>
    </div>

    <!-- é ‚éƒ¨æ¨™é¡Œèˆ‡å°èˆª -->
    <header class="w-full max-w-4xl text-center mb-4 p-4 bg-primary-pink rounded-2xl shadow-lg border-b-4 border-pink-400">
        <h1 class="text-3xl md:text-5xl font-extrabold text-white tracking-wider">
            <!-- å¯æ„›å°è±¬åœ–ç¤º (SVG) -->
            <svg class="h-10 w-10 md:h-12 md:w-12 inline-block mr-3 transform -translate-y-1" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" clip-rule="evenodd" d="M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM15 9C15.8284 9 16.5 8.32843 16.5 = 7.5C16.5 6.67157 15.8284 6 15 6C14.1716 6 13.5 6.67157 13.5 7.5C13.5 8.32843 14.1716 9 15 9ZM9 9C9.82843 9 10.5 8.32843 10.5 7.5C10.5 6.67157 9.82843 6 9 6C8.17157 6 7.5 6.67157 7.5 7.5C7.5 8.32843 8.17157 9 9 9Z" fill="#FF8FAB"/>
                <path d="M12 17C14.2091 17 16 15.2091 16 13C16 10.7909 14.2091 9 12 9C9.79086 9 8 10.7909 8 13C8 15.2091 9.79086 17 12 17Z" fill="#F0B5C2"/>
                <circle cx="11" cy="13" r="1" fill="#FF8FAB"/>
                <circle cx="13" cy="13" r="1" fill="#FF8FAB"/>
            </svg>
            è‹±æ–‡éŠæ¨‚åœ’
        </h1>
    </header>

    <!-- å°èˆªåˆ— -->
    <nav class="w-full max-w-4xl mb-6">
        <div class="flex flex-wrap justify-center space-x-2 md:space-x-4">
            <!-- Tab æŒ‰éˆ•ä½¿ç”¨äº‹ä»¶å§”è¨— (Event Delegation) è™•ç† -->
            <button data-game="game1" id="tab-game1" onclick="changeGame('game1')" class="tab-btn bg-white py-2 px-3 md:px-6 rounded-full text-sm md:text-lg font-bold text-gray-700 transition duration-300 shadow-md">
                ğŸ¦– è©å½™é…å°
            </button>
            <button data-game="game2" id="tab-game2" onclick="changeGame('game2')" class="tab-btn bg-white py-2 px-3 md:px-6 rounded-full text-sm md:text-lg font-bold text-gray-700 transition duration-300 shadow-md">
                ğŸ¤– å­—æ¯æ‹¼åœ–
            </button>
            <button data-game="game3" id="tab-game3" onclick="changeGame('game3')" class="tab-btn bg-white py-2 px-3 md:px-6 rounded-full text-sm md:text-lg font-bold text-gray-700 transition duration-300 shadow-md">
                ğŸ¦¸ å‹•ä½œæŒ‡ä»¤
            </button>
            <button data-game="game4" id="tab-game4" onclick="changeGame('game4')" class="tab-btn bg-white py-2 px-3 md:px-6 rounded-full text-sm md:text-lg font-bold text-gray-700 transition duration-300 shadow-md">
                ğŸš— æ–‡æ³•åœè»Šå ´
            </button>
            <!-- æ›¿æ›ç‚º Who's Lying? -->
            <button data-game="game5" id="tab-game5" onclick="changeGame('game5')" class="tab-btn bg-white py-2 px-3 md:px-6 rounded-full text-sm md:text-lg font-bold text-gray-700 transition duration-300 shadow-md">
                ğŸ¤¥ èª°èªªè¬Šäº†?
            </button>
            <!-- å–®å­—å¾Œå° Tab -->
            <button data-game="admin" id="tab-admin" onclick="changeGame('admin')" class="tab-btn bg-white py-2 px-3 md:px-6 rounded-full text-sm md:text-lg font-bold text-gray-700 transition duration-300 shadow-md">
                âš™ï¸ å–®å­—å¾Œå°
            </button>
        </div>
    </nav>

    <!-- ä¸»å…§å®¹å€ -->
    <main id="game-content" class="w-full max-w-4xl bg-white p-4 md:p-8 rounded-2xl shadow-xl border-4 border-secondary-blue flex flex-col space-y-6 min-h-[500px]">
        <!-- å…§å®¹ç”± JS æ¸²æŸ“ -->
        <div class="flex justify-center items-center h-full">
            <p class="text-xl text-gray-500">æ­£åœ¨è¼‰å…¥æ‡‰ç”¨ç¨‹å¼...</p>
        </div>
    </main>

    <!-- å…¨åŸŸç‹€æ…‹èˆ‡è¨­å®š -->
    <script>
        // å­—æ¯è¡¨ (å°å¯«)
        const ALPHABET = 'abcdefghijklmnopqrstuvwxyz'.split(''); 
        const LOCAL_STORAGE_KEY = 'G_CustomWords_Unified_V2'; // çµ±ä¸€çš„ localStorage key
        
        // å…§å»ºå–®å­—åº« - åƒ…åœ¨è‡ªè¨‚å–®å­—ç‚ºç©ºæ™‚ä½¿ç”¨
        const DICTIONARY_MAP = {
            game1: [ // Dino Egg Match: Noun/Emoji pairs (Word, Emoji)
                { word: "T-REX", image: "ğŸ¦–" }, { word: "EGG", image: "ğŸ¥š" }, { word: "YELLOW", image: "ğŸŸ¡" }, 
                { word: "THREE", image: "3ï¸âƒ£" }, { word: "RED", image: "ğŸ”´" }, { word: "CAR", image: "ğŸš—" }
            ],
            game2: [ // Robot Letter Puzzle: Simple Spelling
                "ROBOT", "BIKE", "LION", "DUCK", "JUMP"
            ],
            game3: [ // Superhero Action: Action Verbs (Verb, Image/Emoji)
                { verb: "JUMP", image: "â¬†ï¸" }, { verb: "RUN", image: "ğŸ’¨" }, { verb: "FLY", image: "ğŸ¦¸" },
                { verb: "CLIMB", image: "ğŸ§—" }, { verb: "WALK", image: "ğŸš¶" }, { verb: "SIT", image: "ğŸª‘" }
            ],
            game4: [ // Grammar Parking Lot: Simple Sentences (Pattern, Options, Answer)
                { pattern: "I ____ HAPPY.", options: ["AM", "IS", "ARE"], answer: "AM" },
                { pattern: "HE ____ SAD.", options: ["AM", "IS", "ARE"], answer: "IS" },
                { pattern: "WE ____ FRIENDS.", options: ["AM", "IS", "ARE"], answer: "ARE" },
                { pattern: "THE APPLE IS ____ THE BOX.", options: ["IN", "ON", "UNDER"], answer: "IN" },
                { pattern: "THE CAT IS ____ THE CHAIR.", options: ["IN", "ON", "UNDER"], answer: "UNDER" }
            ],
            game5: [ // Who's Lying? (Statement, Answer)
                { statement: "A cat has four legs.", answer: "TRUE" },
                { statement: "The sun is green.", answer: "FALSE" },
                { statement: "You are a student.", answer: "TRUE" },
                { statement: "Fish can walk.", answer: "FALSE" }
            ]
        };

        const NUM_GAME1_CARDS = 8; // 4 pairs

        // çµ±ä¸€å„²å­˜å¾ localStorage è¼‰å…¥çš„è‡ªè¨‚å–®å­— (çµæ§‹åŒ–)
        let localCustomWords = {
            game1: [], // Dino Egg: [{word: "...", image: "..."}]
            game2: [], // Robot Puzzle: [{word: "..."}]
            game3: [], // Superhero: [{word: "...", image: "..."}]
            game4: [], // Parking Lot: [{pattern: "...", options: "...", answer: "..."}]
            game5: []  // Who's Lying?: [{statement: "...", answer: "..."}]
        }; 

        let currentGame = 'game1';
        
        let state = {
            // Question Pools and Review System for Games 1-5
            pools: {
                game1: { pool: [], missed: [] },
                game2: { pool: [], missed: [] },
                game3: { pool: [], missed: [] },
                game4: { pool: [], missed: [] },
                game5: { pool: [], missed: [] },
            },

            // Game 1 (Dino Egg)
            g1_cards: [],
            g1_flipped: [],
            g1_matchCount: 0,
            g1_currentQuestionItem: null, // ç´€éŒ„ç•¶å‰å•é¡Œå°è±¡ (ä¾†è‡ª pool æˆ– missed)

            // Game 2 (Robot Puzzle)
            g2_currentWord: '',
            g2_shuffledLetters: [],
            g2_userLetters: [], 
            g2_targetLetters: [], 
            g2_currentQuestionItem: null,

            // Game 3 (Superhero Action)
            g3_currentAction: null, 
            g3_score: 0,
            g3_currentQuestionItem: null,

            // Game 4 (Parking Lot)
            g4_currentSentence: null,
            g4_isLocked: false,
            g4_currentQuestionItem: null,
            
            // Game 5 (Who's Lying?)
            g5_currentStatement: null,
            g5_gameStatus: 'ready',
            g5_shaker: { true: false, false: false }, // ç´€éŒ„å“ªå€‹è§’è‰²è¦éœ‡å‹•
            g5_currentQuestionItem: null,

            // Admin
            admin_currentGameKey: 'game3' 
        };


        // --- TTS ç›¸é—œå·¥å…·å‡½å¼ (ä½¿ç”¨ç€è¦½å™¨ SpeechSynthesis) ---
        async function callTTS(text) {
            if (!('speechSynthesis' in window)) {
                MessageBox.show("ç€è¦½å™¨ä¸æ”¯æŒèªéŸ³æ’­æ”¾åŠŸèƒ½ã€‚", true);
                return;
            }
            
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'en-US'; 
            utterance.rate = 0.9;
            
            await new Promise(resolve => {
                utterance.onend = resolve;
                utterance.onerror = (e) => {
                    console.error("SpeechSynthesis error:", e);
                    MessageBox.show("èªéŸ³æ’­æ”¾å¤±æ•—ã€‚", true);
                    resolve();
                };
                window.speechSynthesis.speak(utterance);
            });
        }


        // éŒ¯èª¤è™•ç†æ¨¡çµ„
        const MessageBox = {
            show: (message, isError = true) => {
                const box = document.getElementById('message-box');
                const content = document.getElementById('message-content');
                
                content.textContent = message;
                box.classList.remove('hidden', 'bg-red-500', 'bg-green-500');
                box.classList.add(isError ? 'bg-red-500' : 'bg-green-500');

                setTimeout(() => box.classList.add('hidden'), 3000);
            }
        };

        // --- LocalStorage å­˜å„²åŠŸèƒ½ ---
        function loadWordsFromLocal() {
            try {
                const stored = localStorage.getItem(LOCAL_STORAGE_KEY);
                const loadedData = stored ? JSON.parse(stored) : {};
                
                // ç¢ºä¿ loadedData æ˜¯æœ‰æ•ˆçš„ç‰©ä»¶ï¼Œä¸¦åˆä½µåˆ° localCustomWords
                localCustomWords.game1 = Array.isArray(loadedData.game1) ? loadedData.game1 : [];
                localCustomWords.game2 = Array.isArray(loadedData.game2) ? loadedData.game2 : [];
                localCustomWords.game3 = Array.isArray(loadedData.game3) ? loadedData.game3 : [];
                localCustomWords.game4 = Array.isArray(loadedData.game4) ? loadedData.game4 : [];
                localCustomWords.game5 = Array.isArray(loadedData.game5) ? loadedData.game5 : [];

            } catch (e) {
                console.error("Error loading words from local storage:", e);
                // è¼‰å…¥å¤±æ•—æ™‚ï¼Œä½¿ç”¨ç©ºåˆ—è¡¨
                localCustomWords = { game1: [], game2: [], game3: [], game4: [], game5: [] };
            }
        }

        function saveWordsToLocal() {
            try {
                localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(localCustomWords));
            } catch (e) {
                console.error("Error saving words to local storage:", e);
                MessageBox.show("ç„¡æ³•ä¿å­˜å–®å­—åˆ°æ‚¨çš„ç€è¦½å™¨ã€‚", true);
            }
        }
        
        /**
         * ç²å–æŒ‡å®šéŠæˆ²çš„å–®å­—åº« (å„ªå…ˆè‡ªè¨‚ï¼Œå¦å‰‡å…§å»º)
         * @param {string} gameKey 'game1', 'game2', 'game3', 'game4', 'game5'
         * @returns {Array} å–®å­—åˆ—è¡¨
         */
        function getWordList(gameKey) {
            const custom = localCustomWords[gameKey] || [];
            if (custom.length > 0) return custom;
            return DICTIONARY_MAP[gameKey] || [];
        }
        
        function shuffleArray(array) {
            let temp = [...array];
            for (let i = temp.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [temp[i], temp[j]] = [temp[j], temp[i]];
            }
            return temp;
        }

        /**
         * æå–å•é¡Œçš„å”¯ä¸€è­˜åˆ¥éµï¼Œç”¨æ–¼ pool/missed æ¯”è¼ƒ
         * @param {object|string} item å•é¡Œå°è±¡
         * @param {string} gameKey 
         * @returns {string} å”¯ä¸€è­˜åˆ¥éµ (Word, Verb, Pattern, or Statement)
         */
        function getItemKey(item, gameKey) {
            if (typeof item === 'string') return item.toUpperCase(); // Game 2 (string-based)
            if (gameKey === 'game1' || gameKey === 'game2') return item.word.toUpperCase();
            if (gameKey === 'game3') return item.verb.toUpperCase();
            if (gameKey === 'game4') return item.pattern.toUpperCase();
            if (gameKey === 'game5') return item.statement; // Statement is key
            return null;
        }

        /**
         * å¾ pool æˆ– missed ä¸­æŠ½å–ä¸‹ä¸€å€‹å•é¡Œ
         * @param {string} gameKey éŠæˆ²éµ
         * @returns {object|null} æŠ½åˆ°çš„é …ç›®å’Œå…¶ä¾†æº ('pool'/'missed')
         */
        function drawNextItem(gameKey) {
            const pools = state.pools[gameKey];
            const sourceList = getWordList(gameKey);

            // 1. åˆå§‹åŒ–æˆ–é‡è¨­ Pool (å¦‚æœéƒ½ç©ºäº†)
            if (pools.pool.length === 0 && pools.missed.length === 0) {
                if (sourceList.length === 0) return null;

                // è¤‡è£½æ•´å€‹è©å½™åˆ—è¡¨åˆ° Pool
                pools.pool = [...sourceList];
                pools.missed = [];
                MessageBox.show(`[${gameKey}] å·²é–‹å§‹æ–°ä¸€è¼ªå–®å­—å­¸ç¿’ï¼`, false);
            }

            let item = null;
            let source = '';

            if (pools.missed.length > 0) {
                // 2. å„ªå…ˆå¾ Missed ä¸­æŠ½ (ä¸ç§»é™¤ï¼Œç›´åˆ°ç­”å°)
                const index = Math.floor(Math.random() * pools.missed.length);
                item = pools.missed[index];
                source = 'missed';
            } else if (pools.pool.length > 0) {
                // 3. å¾ Pool ä¸­æŠ½ (ç§»é™¤)
                const index = Math.floor(Math.random() * pools.pool.length);
                item = pools.pool.splice(index, 1)[0];
                source = 'pool';
            }
            
            // å°‡ item è½‰æ›ç‚ºç‰©ä»¶å½¢å¼ (å³ä½¿æ˜¯ Game 2 ä¹Ÿè¦åŒ…è£æˆ {word: string} ä»¥ä¾¿çµ±ä¸€è™•ç†)
            let questionItem = typeof item === 'string' ? { word: item } : item;

            return { item: questionItem, source: source };
        }

        /**
         * è™•ç†ç­”é¡Œçµæœï¼Œæ›´æ–° pool å’Œ missed åˆ—è¡¨
         * @param {string} gameKey éŠæˆ²éµ
         * @param {object} item ç•¶å‰å•é¡Œå°è±¡
         * @param {boolean} isCorrect æ˜¯å¦ç­”å°
         * @param {string} source ä¾†æº ('pool'/'missed')
         */
        function updatePools(gameKey, item, isCorrect, source) {
            const pools = state.pools[gameKey];
            const itemKey = getItemKey(item, gameKey);

            if (isCorrect) {
                // ç­”å°: å¾ missed ä¸­ç§»é™¤ (å¦‚æœå­˜åœ¨)
                for (let i = pools.missed.length - 1; i >= 0; i--) {
                    if (getItemKey(pools.missed[i], gameKey) === itemKey) {
                        pools.missed.splice(i, 1);
                        break;
                    }
                }
                
            } else {
                // ç­”éŒ¯: åŠ å…¥ missed (å¦‚æœä¸åœ¨ missed ä¸­ï¼Œä¸”ä¸æ˜¯å‰›å¾ pool ç§»é™¤çš„æ–°é¡Œ)
                let alreadyMissed = pools.missed.some(missedItem => getItemKey(missedItem, gameKey) === itemKey);

                // åªæœ‰ç•¶å®ƒé‚„ä¸åœ¨ missed åˆ—è¡¨ä¸­æ™‚æ‰åŠ å…¥ï¼Œé¿å…é‡è¤‡ç´¯ç©
                if (!alreadyMissed) {
                    pools.missed.push(item);
                }
            }
        }


        // --- æ ¸å¿ƒæ‡‰ç”¨ç¨‹å¼æ§åˆ¶ ---
        function setTabActive(gameName) {
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('bg-primary-pink', 'text-white', 'shadow-xl', 'scale-105');
                btn.classList.add('bg-white', 'text-gray-700', 'shadow-md');
            });

            const activeTab = document.getElementById(`tab-${gameName}`);
            if (activeTab) {
                activeTab.classList.remove('bg-white', 'text-gray-700', 'shadow-md');
                activeTab.classList.add('bg-primary-pink', 'text-white', 'shadow-xl', 'scale-105');
            }
        }

        function changeGame(gameName) {
            currentGame = gameName;
            setTabActive(gameName);
            renderApp();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function renderApp() {
            loadWordsFromLocal(); 

            switch (currentGame) {
                case 'game1':
                    initGame1(true); // Added initial flag
                    break;
                case 'game2':
                    initGame2(true);
                    break;
                case 'game3':
                    initGame3(true);
                    break;
                case 'game4':
                    initGame4(true); 
                    break;
                case 'game5':
                    initGame5(true);
                    break;
                case 'admin': 
                    renderWordAdmin();
                    break;
            }
        }

        window.onload = function() {
            setTabActive(currentGame);
            renderApp();
        }
    </script>


    <script>
        // --- éŠæˆ² 1 (æé¾è›‹è©å½™é…å°) é‚è¼¯ ---
        function initGame1(isInit = false) {
            if (isInit) {
                state.g1_matchCount = 0;
            }
            
            const requiredPairs = NUM_GAME1_CARDS / 2;
            const itemObj = drawNextItem('game1');

            if (!itemObj) {
                 MessageBox.show(`è©å½™é…å°éŠæˆ²éœ€è¦ ${requiredPairs} çµ„è©å½™/åœ–ç‰‡ï¼Œè«‹è‡³å¾Œå° (éŠæˆ²1) æ–°å¢ã€‚`, true);
                 renderGame1(true);
                 return;
            }
            
            // ç”±æ–¼ Game 1 éœ€è¦ 4 çµ„ï¼Œæ‰€ä»¥æˆ‘å€‘éœ€è¦æª¢æŸ¥ç•¶å‰ pool + missed ç¸½æ•¸æ˜¯å¦è¶³å¤ 
            const availableItems = [...state.pools.game1.pool, ...state.pools.game1.missed];
            if (availableItems.length < requiredPairs) {
                 MessageBox.show(`[è©å½™é…å°] å–®å­—åº«ä¸è¶³ ${requiredPairs} çµ„ï¼Œè«‹è‡³å¾Œå° (éŠæˆ²1) æ–°å¢ã€‚`, true);
                 renderGame1(true);
                 return;
            }
            
            // é‡è¨­å¡ç‰‡ç‹€æ…‹
            state.g1_cards = [];
            state.g1_flipped = [];
            state.g1_matchCount = 0;
            
            // ç”±æ–¼ drawNextItem åªèƒ½æŠ½ä¸€å€‹ï¼Œé€™è£¡éœ€è¦åšç‰¹æ®Šè™•ç†ï¼šç¢ºä¿æŠ½åˆ° 4 å€‹ä¸é‡è¤‡çš„ item
            let selectedPairs = [];
            let itemKeysInPlay = new Set();

            // ç¢ºä¿ç¬¬ä¸€å€‹ (itemObj.item) æ˜¯å…¶ä¸­ä¸€å€‹
            selectedPairs.push(itemObj.item);
            itemKeysInPlay.add(getItemKey(itemObj.item, 'game1'));
            
            // æŠ½å–å‰©é¤˜çš„ 3 å€‹é …ç›®
            let tempPool = [...state.pools.game1.pool, ...state.pools.game1.missed].filter(item => !itemKeysInPlay.has(getItemKey(item, 'game1')));
            tempPool = shuffleArray(tempPool);
            
            for (let i = 0; selectedPairs.length < requiredPairs && i < tempPool.length; i++) {
                 selectedPairs.push(tempPool[i]);
                 itemKeysInPlay.add(getItemKey(tempPool[i], 'game1'));
            }

            // æœ€çµ‚ç¢ºä¿åªæœ‰ 4 å€‹ï¼Œå¦‚æœå–®å­—åº«å¤ªå°‘ï¼Œé€™è£¡æœƒå‡ºå•é¡Œï¼Œä½†å·²ç¶“åœ¨ä¸Šé¢æª¢æŸ¥éäº†ã€‚
            
            // **è™•ç† Pool ç§»é™¤é‚è¼¯ (åªç§»é™¤æ–°é¡Œï¼ŒéŒ¯é¡Œä¿ç•™)**
            selectedPairs.forEach(pair => {
                const key = getItemKey(pair, 'game1');
                // å¦‚æœæ˜¯æ–°é¡Œ (ä¸åœ¨ Missed ä¸­)ï¼Œå‰‡å¾ Pool ä¸­ç§»é™¤ (å› ç‚ºå·²ç¶“å‡ºéäº†)
                const isNewItem = !state.pools.game1.missed.some(missedItem => getItemKey(missedItem, 'game1') === key);
                if (isNewItem) {
                    const poolIndex = state.pools.game1.pool.findIndex(p => getItemKey(p, 'game1') === key);
                    if (poolIndex !== -1) {
                         state.pools.game1.pool.splice(poolIndex, 1);
                    }
                }
            });

            // è¨­ç½®ç•¶å‰å•é¡Œé›† (ç”¨æ–¼åˆ¤æ–·æ˜¯å¦ç­”å°æ•´å€‹éŠæˆ²)
            state.g1_currentQuestionItem = selectedPairs;

            let cardValues = []; // FIX: Initialize cardValues here

            // ç”Ÿæˆå¡ç‰‡ (èˆ‡èˆŠé‚è¼¯ç›¸åŒ)
            selectedPairs.forEach((pair, index) => {
                const groupId = `match-${index}`; 
                cardValues.push({ id: crypto.randomUUID(), value: pair.image, type: 'image', groupId, matched: false, flipped: false, key: getItemKey(pair, 'game1') });
                cardValues.push({ id: crypto.randomUUID(), value: pair.word.toUpperCase(), type: 'word', groupId, matched: false, flipped: false, key: getItemKey(pair, 'game1') });
            });
            
            state.g1_cards = shuffleArray(cardValues);
            renderGame1();
        }

        function handleCardClickG1(id) {
            const cardIndex = state.g1_cards.findIndex(c => c.id === id);
            const card = state.g1_cards[cardIndex];

            if (!card || card.matched || card.flipped || state.g1_flipped.length === 2) {
                return;
            }

            card.flipped = true;
            state.g1_flipped.push(card);
            renderGame1(); 

            if (state.g1_flipped.length === 2) {
                const [card1, card2] = state.g1_flipped;
                const isMatch = card1.groupId === card2.groupId;
                
                if (isMatch) {
                    card1.matched = true;
                    card2.matched = true;
                    state.g1_matchCount++;
                    
                    state.g1_flipped = []; 
                    renderGame1(); 
                    
                    // æª¢æŸ¥æ‰€æœ‰é…å°æ˜¯å¦å®Œæˆ
                    if (state.g1_matchCount === NUM_GAME1_CARDS / 2) {
                        MessageBox.show("å¤ªæ£’äº†ï¼æ‰€æœ‰æé¾è›‹éƒ½é…å°æˆåŠŸäº†ï¼ğŸ‰", false);
                        
                        // æ•´å€‹éŠæˆ²é›†ç­”å°ï¼šå°‡æ‰€æœ‰ä½¿ç”¨çš„å–®å­—å¾ missed ä¸­ç§»é™¤
                        state.g1_currentQuestionItem.forEach(item => {
                             updatePools('game1', item, true, 'N/A');
                        });
                        
                        setTimeout(initGame1, 1500); // é€²å…¥ä¸‹ä¸€è¼ª
                    }
                } else {
                    // ç­”éŒ¯: å°‡ç•¶å‰éŠæˆ²é›†çš„æ‰€æœ‰é …ç›®åŠ å…¥ missed
                    state.g1_currentQuestionItem.forEach(item => {
                         updatePools('game1', item, false, 'N/A');
                    });
                    
                    setTimeout(() => {
                        const index1 = state.g1_cards.findIndex(c => c.id === card1.id);
                        const index2 = state.g1_cards.findIndex(c => c.id === card2.id);
                        
                        if (index1 !== -1) state.g1_cards[index1].flipped = false;
                        if (index2 !== -1) state.g1_cards[index2].flipped = false;
                        
                        state.g1_flipped = [];
                        renderGame1(); 
                    }, 1500); 
                }
            }
        }

        function renderGame1(wordError = false) {
             // ... rendering logic remains largely the same, but pool info should be displayed ...
             const container = document.getElementById('game-content');
            if (currentGame !== 'game1') return;

            if (wordError) {
                container.innerHTML = `<p class="text-red-500 text-center text-xl p-8">éŠæˆ²ç„¡æ³•é–‹å§‹ï¼šè©å½™ä¸è¶³ï¼è«‹å‰å¾€å–®å­—å¾Œå° (éŠæˆ²1) æ–°å¢ã€‚</p>`;
                return;
            }

            const cardsHtml = state.g1_cards.map(card => {
                const innerStyle = card.type === 'word' ? 'font-size: 1.5rem;' : 'font-size: 2.5rem;';

                return `
                    <div class="h-28 w-28 md:h-32 md:w-32 mx-auto perspective-[1000px]" onclick="handleCardClickG1('${card.id}')">
                        <div class="dino-card ${card.flipped || card.matched ? 'flipped' : ''} ${card.matched ? 'matched' : ''}" style="transition: transform 0.8s;">
                            <!-- èƒŒé¢ (æœªç¿»é–‹) -->
                            <div class="dino-card-inner dino-card-front text-4xl transform-gpu">
                                ğŸ¥š
                            </div>
                            <!-- æ­£é¢ (å…§å®¹) -->
                            <div class="dino-card-inner dino-card-back text-gray-800 transform-gpu" style="${innerStyle}">
                                ${card.value.toLowerCase()}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            container.innerHTML = `
                <section class="w-full bg-accent-yellow p-4 rounded-xl shadow-inner border-b-8 border-yellow-600">
                    <h2 class="text-xl md:text-3xl font-bold text-yellow-900 mb-4 text-center">ğŸ¦– æé¾è›‹è©å½™é…å° (Dino Egg Match)</h2>
                    <p class="text-center text-sm mb-2">ç›®æ¨™: é»æ“Šæé¾è›‹ï¼Œé…å°å–®å­—å’Œåœ–ç‰‡ (å…± ${NUM_GAME1_CARDS / 2} çµ„)ã€‚</p>
                    <p class="text-center text-xs text-gray-700 mb-4">
                        æ–°é¡Œåº«: ${state.pools.game1.pool.length} | éŒ¯é¡Œåº«: ${state.pools.game1.missed.length}
                    </p>
                    <div id="dino-match-grid" class="grid grid-cols-4 gap-3 md:gap-4 max-w-lg mx-auto">
                        ${cardsHtml}
                    </div>
                    <div class="text-center mt-6">
                        <button onclick="initGame1(true)" class="bg-primary-pink hover:bg-pink-400 text-white font-bold py-2 px-6 rounded-full shadow-cute text-lg">
                            é‡æ–°é–‹å§‹/ä¸‹ä¸€è¼ª
                        </button>
                    </div>
                </section>
            `;
        }
        // --- éŠæˆ² 1 é‚è¼¯çµæŸ ---

        // --- éŠæˆ² 2 (æ©Ÿå™¨äººå­—æ¯æ‹¼åœ–) é‚è¼¯ ---
        function initGame2(isInit = false) {
            newQuestionG2(isInit);
        }

        function newQuestionG2(isInit = false) {
            const sourceWords = getWordList('game2');
            if (sourceWords.length === 0) {
                 MessageBox.show(`å­—æ¯æ‹¼åœ–éŠæˆ²éœ€è¦å–®å­—ï¼Œè«‹è‡³å¾Œå° (éŠæˆ²2) æ–°å¢ã€‚`, true);
                 renderGame2(true);
                 return;
            }
            
            const itemObj = drawNextItem('game2');
            if (!itemObj) {
                // å¦‚æœ pool å’Œ missed éƒ½ç©ºäº†ï¼Œé‡æ–°å‘¼å« initGame2 é€²è¡Œé‡è¨­
                initGame2(true);
                return;
            }

            // ç¢ºä¿ word å±¬æ€§å­˜åœ¨
            const randomWord = itemObj.item.word;
            
            state.g2_currentQuestionItem = itemObj.item; 

            state.g2_currentWord = randomWord.toUpperCase(); 
            
            const targetLetters = state.g2_currentWord.split('');
            state.g2_shuffledLetters = shuffleArray(targetLetters).map(l => ({ 
                id: crypto.randomUUID(), 
                value: l, 
                used: false 
            }));
            
            state.g2_targetLetters = targetLetters.map(l => ({ value: l, filled: null })); 
            state.g2_userLetters = Array(targetLetters.length).fill(null); 
            
            renderGame2();
        }
        
        // æ‹–æ›³äº‹ä»¶è™•ç† (ç°¡åŒ–ç‚ºé»æ“Šå¡«ç©º)
        function handleLetterClickG2(letterId) {
            const letterObj = state.g2_shuffledLetters.find(l => l.id === letterId);
            if (!letterObj || letterObj.used) return;
            
            const targetIndex = state.g2_userLetters.findIndex(l => l === null);

            if (targetIndex !== -1) {
                // å¡«å……ç›®æ¨™æ¬„ä½
                state.g2_userLetters[targetIndex] = letterObj.value;
                letterObj.used = true;
                
                checkCompletionG2();
                renderGame2();
            }
        }
        
        function handleTargetClickG2(targetIndex) {
            const letterValue = state.g2_userLetters[targetIndex];
            if (!letterValue) return;

            // é‡‹æ”¾è¢«ä½¿ç”¨çš„å­—æ¯å¡Š
            const usedLetterObj = state.g2_shuffledLetters.find(l => l.value === letterValue && l.used);
            if (usedLetterObj) {
                usedLetterObj.used = false;
            }

            state.g2_userLetters[targetIndex] = null;
            renderGame2();
        }

        function checkCompletionG2() {
            if (state.g2_userLetters.some(l => l === null)) return;
            
            const guessedWord = state.g2_userLetters.join('');
            const isCorrect = guessedWord === state.g2_currentWord;
            
            if (isCorrect) {
                MessageBox.show(`å¤ªæ£’äº†ï¼æ©Ÿå™¨äººçµ„è£æˆåŠŸï¼š${state.g2_currentWord}ï¼ğŸ‰`, false);
                updatePools('game2', state.g2_currentQuestionItem, true, 'N/A');
                setTimeout(newQuestionG2, 1500);
            } else {
                MessageBox.show("æ‹¼å­—éŒ¯èª¤ï¼Œå†è©¦è©¦çœ‹ï¼", true);
                updatePools('game2', state.g2_currentQuestionItem, false, 'N/A');
            }
        }

        function renderGame2(wordError = false) {
            const container = document.getElementById('game-content');
            if (currentGame !== 'game2') return;

            if (wordError) {
                container.innerHTML = `<p class="text-red-500 text-center text-xl p-8">éŠæˆ²ç„¡æ³•é–‹å§‹ï¼šå–®å­—åº«ä¸è¶³ï¼è«‹å‰å¾€å–®å­—å¾Œå° (éŠæˆ²2) æ–°å¢ã€‚</p>`;
                return;
            }

            const targetHtml = state.g2_targetLetters.map((target, index) => {
                const letter = state.g2_userLetters[index];
                const isCorrect = letter === target.value;
                const displayClass = letter ? (isCorrect ? 'bg-green-300' : 'bg-red-300') : 'bg-white';
                
                return `
                    <div class="flex flex-col items-center">
                        <div class="robot-target w-12 h-12 md:w-16 md:h-16 ${letter ? 'filled' : ''} ${displayClass} text-2xl font-bold" onclick="handleTargetClickG2(${index})">
                            ${letter ? letter.toLowerCase() : '?'}
                        </div>
                        <p class="text-xs mt-1 text-gray-500">${index + 1}</p>
                    </div>
                `;
            }).join('');

            const shuffledHtml = state.g2_shuffledLetters.map(letter => {
                const buttonClass = letter.used ? 'opacity-30 cursor-not-allowed' : 'hover:bg-yellow-400';
                return `
                    <button class="robot-part text-2xl md:text-3xl ${buttonClass}" 
                            onclick="handleLetterClickG2('${letter.id}')"
                            ${letter.used ? 'disabled' : ''}>
                        ${letter.value.toLowerCase()}
                    </button>
                `;
            }).join('');

            container.innerHTML = `
                <section class="w-full bg-secondary-blue p-4 rounded-xl shadow-inner border-b-8 border-blue-600">
                    <h2 class="text-xl md:text-3xl font-bold text-blue-800 mb-2 text-center">ğŸ¤– æ©Ÿå™¨äººå­—æ¯æ‹¼åœ– (Robot Letter Puzzle)</h2>
                    <p class="text-center text-sm mb-2">ç›®æ¨™: é»æ“Šä¸‹æ–¹çš„æ©Ÿå™¨äººéƒ¨ä»¶ (å­—æ¯)ï¼Œä¾åºå¡«å…¥æ­£ç¢ºä½ç½®ï¼Œæ‹¼å‡ºå–®å­—ã€‚</p>
                    <p class="text-center text-xs text-gray-700 mb-4">
                        æ–°é¡Œåº«: ${state.pools.game2.pool.length} | éŒ¯é¡Œåº«: ${state.pools.game2.missed.length}
                    </p>
                </section>
                
                <div class="flex flex-col items-center p-6 bg-keyboard-bg rounded-xl shadow-md">
                    <p class="text-3xl md:text-5xl mb-4 font-extrabold text-blue-800">
                        ç›®æ¨™å–®å­—é•·åº¦: ${state.g2_currentWord.length}
                    </p>
                    
                    <!-- è½åŠ›æŒ‰éˆ• -->
                    <button onclick="callTTS(state.g2_currentWord)" class="bg-primary-pink hover:bg-pink-400 text-white font-bold py-2 px-6 rounded-full shadow-cute text-lg mb-6">
                        ğŸ”Š é»æ“Šè†è½å–®å­—
                    </button>

                    <!-- æ‹¼å­—ç›®æ¨™å€ -->
                    <div class="flex space-x-2 md:space-x-3 mb-8">
                        ${targetHtml}
                    </div>

                    <!-- æ©Ÿå™¨äººéƒ¨ä»¶ (å­—æ¯å¡Š) -->
                    <div class="flex flex-wrap justify-center gap-2 md:gap-3 p-4 bg-white rounded-lg shadow-inner border-4 border-gray-300">
                        ${shuffledHtml}
                    </div>
                    
                    <div class="text-center mt-6">
                        <button onclick="newQuestionG2(false)" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-6 rounded-full shadow-cute text-lg">
                            ä¸‹ä¸€å€‹å–®å­—
                        </button>
                    </div>
                </div>
            `;
        }
        // --- éŠæˆ² 2 é‚è¼¯çµæŸ ---
        
        // --- éŠæˆ² 3 (è¶…ç´šè‹±é›„å‹•ä½œæŒ‡ä»¤) é‚è¼¯ ---
        function initGame3(isInit = false) {
            if(isInit) state.g3_score = 0;
            newActionG3();
        }

        function newActionG3() {
            const sourceActions = getWordList('game3');

            if (sourceActions.length < 3) {
                 MessageBox.show(`å‹•ä½œæŒ‡ä»¤éŠæˆ²éœ€è¦è‡³å°‘ 3 å€‹å‹•ä½œï¼Œè«‹è‡³å¾Œå° (éŠæˆ²3) æ–°å¢ã€‚`, true);
                 renderGame3(true);
                 return;
            }
            
            const itemObj = drawNextItem('game3');
            if (!itemObj) {
                initGame3(true);
                return;
            }
            
            const correctAnswer = itemObj.item; // é€™æ˜¯æ­£ç¢ºç­”æ¡ˆ (Item Object)
            state.g3_currentQuestionItem = correctAnswer; 

            // éš¨æ©Ÿé¸æ“‡å¦å¤–å…©å€‹éŒ¯èª¤é¸é …
            const otherActions = sourceActions.filter(a => getItemKey(a, 'game3') !== getItemKey(correctAnswer, 'game3'));
            const wrongAnswers = shuffleArray(otherActions).slice(0, 2);
            
            const allOptions = shuffleArray([correctAnswer, ...wrongAnswers]);

            state.g3_currentAction = {
                command: `${correctAnswer.verb.toUpperCase()}!`,
                correctVerb: correctAnswer.verb,
                options: allOptions
            };
            
            renderGame3();
            // å»¶é²æ’­æ”¾æŒ‡ä»¤
            setTimeout(() => callTTS(state.g3_currentAction.command), 500);
        }

        function handleGuessG3(guessedVerb) {
            if (state.g3_currentAction.isGuessed) return;
            
            state.g3_currentAction.isGuessed = true;
            const isCorrect = guessedVerb === state.g3_currentAction.correctVerb;
            
            if (isCorrect) {
                state.g3_score++;
                MessageBox.show("BINGO! å¤ªæ£’äº†ï¼ğŸ’ª", false);
                updatePools('game3', state.g3_currentQuestionItem, true, 'N/A');
                
                // ç°¡å–®çš„ CSS å‹•ä½œå‹•ç•«
                const heroElement = document.getElementById('superhero-hero');
                if (heroElement) {
                    heroElement.style.transform = 'translateY(-10px) scale(1.1)';
                    setTimeout(() => heroElement.style.transform = 'translateY(0) scale(1)', 500);
                }
            } else {
                state.g3_score = Math.max(0, state.g3_score - 1);
                MessageBox.show(`ç­”éŒ¯äº†ï¼ŒæŒ‡ä»¤æ˜¯ ${state.g3_currentAction.command.toLowerCase()}ã€‚`, true);
                updatePools('game3', state.g3_currentQuestionItem, false, 'N/A');
            }
            
            renderGame3();
            
            // é€²å…¥ä¸‹ä¸€è¼ª
            setTimeout(newActionG3, 2000);
        }

        function renderGame3(wordError = false) {
            const container = document.getElementById('game-content');
            if (currentGame !== 'game3') return;

            if (wordError) {
                container.innerHTML = `<p class="text-red-500 text-center text-xl p-8">éŠæˆ²ç„¡æ³•é–‹å§‹ï¼šå‹•ä½œæŒ‡ä»¤ä¸è¶³ï¼è«‹å‰å¾€å–®å­—å¾Œå° (éŠæˆ²3) æ–°å¢è‡³å°‘ 3 å€‹å‹•ä½œã€‚</p>`;
                return;
            }

            const optionsHtml = state.g3_currentAction?.options.map(option => `
                <button onclick="handleGuessG3('${option.verb}')" 
                        class="superhero-option flex flex-col items-center justify-center p-4 rounded-xl shadow-cute hover:bg-blue-300 transition duration-200"
                        ${state.g3_currentAction.isGuessed ? 'disabled' : ''}>
                    <span class="text-4xl md:text-5xl mb-2">${option.image}</span>
                    <span class="text-sm md:text-lg">${option.verb}</span>
                </button>
            `).join('');

            container.innerHTML = `
                <section class="w-full bg-secondary-blue p-4 rounded-xl shadow-inner border-b-8 border-blue-600">
                    <h2 class="text-xl md:text-3xl font-bold text-blue-800 mb-2 text-center">ğŸ¦¸ è¶…ç´šè‹±é›„å‹•ä½œæŒ‡ä»¤ (Superhero Action)</h2>
                    <p class="text-center text-sm mb-2">ç›®æ¨™: é»æ“Šå–‡å­è†è½æŒ‡ä»¤ï¼Œç„¶å¾Œé»æ“Šæ­£ç¢ºçš„å‹•ä½œåœ–ç¤ºã€‚</p>
                    <p class="text-center text-xs text-gray-700 mb-4">
                        æ–°é¡Œåº«: ${state.pools.game3.pool.length} | éŒ¯é¡Œåº«: ${state.pools.game3.missed.length}
                    </p>
                </section>
                
                <div class="flex flex-col items-center p-6 bg-keyboard-bg rounded-xl shadow-md">
                    <div class="mb-4 flex justify-between w-full max-w-sm">
                        <p class="text-lg font-bold text-gray-700">å¾—åˆ†: ${state.g3_score}</p>
                        <button onclick="newActionG3()" class="text-sm bg-accent-yellow px-3 py-1 rounded-full shadow-md hover:bg-yellow-400">
                            ä¸‹ä¸€é¡Œ
                        </button>
                    </div>

                    <!-- è‹±é›„å€ -->
                    <div id="superhero-hero" class="text-9xl mb-8 transition-transform duration-500 transform-gpu">
                        ğŸ’¥ 
                    </div>

                    <!-- å–‡å­å’ŒæŒ‡ä»¤ -->
                    <button onclick="callTTS(state.g3_currentAction.command)" 
                            class="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-8 rounded-full shadow-cute text-xl flex items-center mx-auto mb-6">
                        ğŸ”Š è†è½æŒ‡ä»¤
                    </button>

                    <!-- é¸é …æŒ‰éˆ• -->
                    <div class="grid grid-cols-3 gap-4 max-w-md w-full">
                        ${optionsHtml}
                    </div>
                </div>
            `;
        }
        // --- éŠæˆ² 3 é‚è¼¯çµæŸ ---

        // --- éŠæˆ² 4 (äº¤é€šå·¥å…·æ–‡æ³•åœè»Šå ´) é‚è¼¯ ---
        function initGame4(isInit = false) {
            state.g4_isLocked = false;
            newSentenceG4();
        }

        function newSentenceG4() {
            const sourceSentences = getWordList('game4');
            if (sourceSentences.length === 0) {
                 MessageBox.show(`æ–‡æ³•åœè»Šå ´éŠæˆ²éœ€è¦å¥å‹ï¼Œè«‹è‡³å¾Œå° (éŠæˆ²4) æ–°å¢ã€‚`, true);
                 renderGame4(true);
                 return;
            }
            
            const itemObj = drawNextItem('game4');
            if (!itemObj) {
                initGame4(true);
                return;
            }
            
            const newSentence = itemObj.item; 
            state.g4_currentQuestionItem = newSentence; 

            state.g4_currentSentence = {
                ...newSentence,
                // æ‰“äº‚é¸é …çš„é †åº
                shuffledOptions: shuffleArray(newSentence.options),
                userAnswer: null
            };
            state.g4_isLocked = false;
            
            renderGame4();
        }
        
        function handleParkingG4(guessedOption) {
            if (state.g4_isLocked) return;

            state.g4_isLocked = true;
            state.g4_currentSentence.userAnswer = guessedOption;

            const isCorrect = guessedOption === state.g4_currentSentence.answer;
            
            renderGame4(); // ç«‹å³æ¸²æŸ“ä»¥é¡¯ç¤ºç­”æ¡ˆå’Œé–å®šæŒ‰éˆ•
            
            updatePools('game4', state.g4_currentQuestionItem, isCorrect, 'N/A');

            const carElement = document.getElementById('parking-car');
            const parkingSpots = document.querySelectorAll('.parking-spot');
            const correctIndex = state.g4_currentSentence.shuffledOptions.findIndex(opt => opt === state.g4_currentSentence.answer);
            const guessIndex = state.g4_currentSentence.shuffledOptions.findIndex(opt => opt === guessedOption);

            if (carElement) {
                if (isCorrect) {
                    MessageBox.show("åœè»ŠæˆåŠŸï¼âœ…", false);
                } else {
                     // éŒ¯èª¤æ™‚æ’­æ”¾éœ‡å‹•æ•ˆæœ
                    carElement.classList.add('animate-pulse');
                    setTimeout(() => carElement.classList.remove('animate-pulse'), 500);
                    MessageBox.show(`ç­”éŒ¯äº†ï¼Œæ­£ç¢ºç­”æ¡ˆæ˜¯ ${state.g4_currentSentence.answer.toLowerCase()}ã€‚`, true);
                }
            }
            
            // å»¶é²é€²å…¥ä¸‹ä¸€é¡Œ
            setTimeout(newSentenceG4, 2500);
        }

        function renderGame4(wordError = false) {
            const container = document.getElementById('game-content');
            if (currentGame !== 'game4') return;

            if (wordError) {
                container.innerHTML = `<p class="text-red-500 text-center text-xl p-8">éŠæˆ²ç„¡æ³•é–‹å§‹ï¼šå¥å‹å–®å­—åº«ä¸è¶³ï¼è«‹å‰å¾€å–®å­—å¾Œå° (éŠæˆ²4) æ–°å¢ã€‚</p>`;
                return;
            }

            const sentenceWithBlank = state.g4_currentSentence.pattern.replace('____', 
                `<span class="text-red-600 font-extrabold p-1 bg-yellow-200 rounded">${state.g4_isLocked ? state.g4_currentSentence.userAnswer : '____'}</span>`
            );

            const optionsHtml = state.g4_currentSentence.shuffledOptions.map((option, index) => {
                const isCorrect = option === state.g4_currentSentence.answer;
                const isGuessed = state.g4_isLocked && option === state.g4_currentSentence.userAnswer;
                
                let spotClass = 'parking-spot hover:shadow-lg hover:scale-[1.02]';
                if (state.g4_isLocked) {
                    spotClass = isGuessed 
                        ? (isCorrect ? 'bg-green-300 border-green-600' : 'bg-red-300 border-red-600')
                        : (isCorrect ? 'bg-yellow-300 border-yellow-600' : 'bg-gray-200 border-gray-400');
                } else {
                     spotClass += ' bg-white';
                }

                return `
                    <div onclick="handleParkingG4('${option}')" 
                         class="text-xl font-bold text-gray-800 text-center ${spotClass} transition duration-300">
                        ${option}
                    </div>
                `;
            }).join('');

            container.innerHTML = `
                <section class="w-full bg-accent-yellow p-4 rounded-xl shadow-inner border-b-8 border-yellow-600">
                    <h2 class="text-xl md:text-3xl font-bold text-yellow-900 mb-2 text-center">ğŸš— äº¤é€šå·¥å…·æ–‡æ³•åœè»Šå ´ (Grammar Parking Lot)</h2>
                    <p class="text-center text-sm mb-2">ç›®æ¨™: é¸æ“‡æ­£ç¢ºçš„å–®å­—/è©çµ„ï¼Œè®“æ±½è»Šåœå…¥æ­£ç¢ºçš„åœè»Šä½ã€‚</p>
                    <p class="text-center text-xs text-gray-700 mb-4">
                        æ–°é¡Œåº«: ${state.pools.game4.pool.length} | éŒ¯é¡Œåº«: ${state.pools.game4.missed.length}
                    </p>
                </section>
                
                <div class="flex flex-col items-center p-6 bg-keyboard-bg rounded-xl shadow-md">
                    
                    <!-- æ±½è»Šåœ–ç¤º -->
                    <div id="parking-car" class="text-6xl mb-4 transition-transform duration-500 car-anim">
                        ğŸš—
                    </div>

                    <!-- å¥å­é¡¯ç¤ºå€ -->
                    <div class="text-3xl md:text-4xl font-semibold mb-8 p-4 bg-white rounded-lg border-4 border-gray-300">
                        ${sentenceWithBlank.toLowerCase()}
                    </div>

                    <!-- åœè»Šä½é¸é … -->
                    <div class="grid grid-cols-3 gap-4 max-w-lg w-full">
                        ${optionsHtml}
                    </div>

                    <div class="text-center mt-6">
                        <button onclick="newSentenceG4()" class="bg-primary-pink hover:bg-pink-400 text-white font-bold py-2 px-6 rounded-full shadow-cute text-lg" ${state.g4_isLocked ? 'disabled' : ''}>
                            è·³é / ä¸‹ä¸€é¡Œ
                        </button>
                    </div>
                </div>
            `;
        }
        // --- éŠæˆ² 4 é‚è¼¯çµæŸ ---

        // --- éŠæˆ² 5 (èª°èªªè¬Šäº†?) é‚è¼¯ ---
        function initGame5(isInit = false) {
            state.g5_gameStatus = 'ready';
            newQuestionG5();
        }

        function newQuestionG5() {
            const sourceQuestions = getWordList('game5');
            if (sourceQuestions.length === 0) {
                 MessageBox.show(`ã€Œèª°èªªè¬Šäº†ï¼Ÿã€éŠæˆ²éœ€è¦å•é¡Œï¼Œè«‹è‡³å¾Œå° (éŠæˆ²5) æ–°å¢ã€‚`, true);
                 renderGame5(true);
                 return;
            }
            
            const itemObj = drawNextItem('game5');
            if (!itemObj) {
                initGame5(true);
                return;
            }

            const randomQuestion = itemObj.item;
            state.g5_currentQuestionItem = randomQuestion; 
            
            state.g5_currentStatement = {
                ...randomQuestion,
                isGuessed: false
            };
            state.g5_shaker = { true: false, false: false };
            state.g5_gameStatus = 'playing';
            renderGame5();
            
            // å»¶é²æ’­æ”¾æŒ‡ä»¤
            setTimeout(() => callTTS(randomQuestion.statement), 500);
        }

        function handleGuessG5(guess) {
            if (state.g5_currentStatement.isGuessed) return;
            
            state.g5_currentStatement.isGuessed = true;
            const correctAnswer = state.g5_currentStatement.answer;
            const isCorrect = guess === correctAnswer;
            
            updatePools('game5', state.g5_currentQuestionItem, isCorrect, 'N/A');
            
            if (isCorrect) {
                MessageBox.show("ç­”å°äº†ï¼é€™ä½äººç‰©èªªçš„æ˜¯å¯¦è©±ï¼ğŸ‰", false);
            } else {
                const lyingPerson = guess.toLowerCase(); // TRUE or FALSE
                state.g5_shaker[lyingPerson] = true;
                
                MessageBox.show("ç­”éŒ¯äº†ï¼é€™å€‹äººç‰©åœ¨èªªè¬Šï¼ğŸ¤¥", true);
            }
            
            renderGame5();
            setTimeout(newQuestionG5, 2500);
        }

        function renderGame5(wordError = false) {
            const container = document.getElementById('game-content');
            if (currentGame !== 'game5') return;

            if (wordError) {
                container.innerHTML = `<p class="text-red-500 text-center text-xl p-8">éŠæˆ²ç„¡æ³•é–‹å§‹ï¼šå•é¡Œå–®å­—åº«ä¸è¶³ï¼è«‹å‰å¾€å–®å­—å¾Œå° (éŠæˆ²5) æ–°å¢ã€‚</p>`;
                return;
            }
            
            const statement = state.g5_currentStatement.statement.toLowerCase();
            const isGuessed = state.g5_currentStatement.isGuessed;

            // åˆ¤æ–·å“ªå€‹è§’è‰²æ˜¯èªªè¬Šè€… (å¦‚æœæ˜¯ TRUE ç­”æ¡ˆï¼Œé‚£éº¼èªª FALSE çš„å°±æ˜¯èªªè¬Šè€…)
            const trueIsLying = isGuessed && state.g5_currentStatement.answer === 'FALSE';
            const falseIsLying = isGuessed && state.g5_currentStatement.answer === 'TRUE';
            
            const trueShaker = state.g5_shaker.true ? 'shaking' : '';
            const falseShaker = state.g5_shaker.false ? 'shaking' : '';
            
            // æ±ºå®šåèˆŒé ­çš„é¡¯ç¤ºï¼Œåªæœ‰åœ¨è¢«é»æ“Šä¸”ç­”éŒ¯æ™‚é¡¯ç¤º
            const showTrueTongue = state.g5_shaker.true;
            const showFalseTongue = state.g5_shaker.false;

            container.innerHTML = `
                <section class="w-full bg-secondary-blue p-4 rounded-xl shadow-inner border-b-8 border-blue-600">
                    <h2 class="text-xl md:text-3xl font-bold text-blue-800 mb-2 text-center">ğŸ¤¥ èª°èªªè¬Šäº†? (Who's Lying? - Reading)</h2>
                    <p class="text-center text-sm mb-2">ç›®æ¨™: é–±è®€çŸ­å¥ä¸¦åˆ¤æ–·çœŸå‡ (True/False)ã€‚</p>
                    <p class="text-center text-xs text-gray-700 mb-4">
                        æ–°é¡Œåº«: ${state.pools.game5.pool.length} | éŒ¯é¡Œåº«: ${state.pools.game5.missed.length}
                    </p>
                </section>

                <div class="flex flex-col items-center p-6 bg-keyboard-bg rounded-xl shadow-md w-full">
                    
                    <div class="mb-6 p-4 md:p-6 bg-white rounded-xl shadow-lg border-4 border-accent-yellow w-full max-w-xl text-center">
                        <h3 class="text-2xl md:text-4xl font-extrabold text-gray-800">
                            "${statement}"
                        </h3>
                    </div>
                    
                    <button onclick="callTTS(state.g5_currentStatement.statement)" 
                            class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-6 rounded-full shadow-cute text-lg mb-8">
                        ğŸ”Š è†è½çŸ­å¥
                    </button>

                    <!-- è§’è‰²é¸é …å€ (True vs False) -->
                    <div class="flex justify-around items-end w-full max-w-3xl">
                        
                        <!-- èª å¯¦é¨å£«/å°ä¸‘ (TRUE) -->
                        <div class="flex flex-col items-center relative p-2">
                            <div id="true-character" class="text-6xl md:text-8xl p-3 mb-2 transition-transform duration-300 relative ${trueShaker}">
                                ${trueIsLying ? 'ğŸ¤¡' : 'ğŸ‘‘'}
                                ${showTrueTongue ? `<span class="tongue-container"><span class="tongue-out">ğŸ‘…</span></span>` : ''}
                            </div>
                            <button onclick="handleGuessG5('TRUE')" 
                                    class="text-2xl md:text-3xl font-extrabold py-3 px-8 rounded-2xl shadow-cute transition duration-150 
                                        ${trueIsLying ? 'bg-red-400 opacity-70 cursor-not-allowed' : 'bg-green-400 hover:bg-green-500'}"
                                    ${isGuessed ? 'disabled' : ''}>
                                TRUE
                            </button>
                            ${isGuessed ? `<p class="text-lg font-bold mt-2 ${trueIsLying ? 'text-red-600' : 'text-green-600'}">${trueIsLying ? 'èªªè¬Šè€…' : 'èª å¯¦è€…'}</p>` : ''}
                        </div>

                        <!-- ç‹¡çŒ¾å°ä¸‘/é¨å£« (FALSE) -->
                        <div class="flex flex-col items-center relative p-2">
                            <div id="false-character" class="text-6xl md:text-8xl p-3 mb-2 transition-transform duration-300 relative ${falseShaker}">
                                ${falseIsLying ? 'ğŸ¤¡' : 'ğŸ‘‘'}
                                ${showFalseTongue ? `<span class="tongue-container"><span class="tongue-out">ğŸ‘…</span></span>` : ''}
                            </div>
                            <button onclick="handleGuessG5('FALSE')" 
                                    class="text-2xl md:text-3xl font-extrabold py-3 px-8 rounded-2xl shadow-cute transition duration-150 
                                        ${falseIsLying ? 'bg-red-400 opacity-70 cursor-not-allowed' : 'bg-green-400 hover:bg-green-500'}"
                                    ${isGuessed ? 'disabled' : ''}>
                                FALSE
                            </button>
                            ${isGuessed ? `<p class="text-lg font-bold mt-2 ${falseIsLying ? 'text-red-600' : 'text-green-600'}">${falseIsLying ? 'èªªè¬Šè€…' : 'èª å¯¦è€…'}</p>` : ''}
                        </div>
                    </div>

                    <div class="text-center mt-8">
                        <button onclick="newQuestionG5()" class="bg-primary-pink hover:bg-pink-400 text-white font-bold py-2 px-6 rounded-full shadow-cute text-lg">
                            ä¸‹ä¸€å€‹å•é¡Œ
                        </button>
                    </div>
                </div>
            `;
        }


        // --- å–®å­—ç®¡ç†å¾Œå° é‚è¼¯ ---
        function changeAdminTarget(gameKey) {
            state.admin_currentGameKey = gameKey;
            renderWordAdmin();
        }

        function addWord() {
            const input1 = document.getElementById('new-word-input-1');
            const input2 = document.getElementById('new-word-input-2');
            const gameKey = state.admin_currentGameKey;
            const wordList = localCustomWords[gameKey];

            const rawValue1 = input1.value.trim();
            const rawValue2 = input2.value.trim(); 
            
            let entriesToAdd = [];
            let errorCount = 0;
            let successMessage = "";

            if (gameKey === 'game2') {
                // éŠæˆ² 2: æ¯è¡Œä¸€å€‹å–®å­—
                const lines = rawValue1.split('\n').map(line => line.trim()).filter(line => line.length > 0);
                lines.forEach(line => {
                    const word = line.toUpperCase();
                    if (/^[A-Z\s]+$/.test(word)) {
                        entriesToAdd.push({ id: crypto.randomUUID(), word: word });
                    } else {
                        errorCount++;
                    }
                });

            } else if (gameKey === 'game4') {
                // éŠæˆ² 4 (ç‰¹æ®Šè™•ç†): æ¬„ä½ 1: é¸é … (é€—è™Ÿåˆ†éš”), æ¬„ä½ 2: å¥å‹ (å–®ç¨è™•ç†)
                const optionsArray = rawValue1.split(',').map(o => o.trim().toUpperCase()).filter(o => o.length > 0);
                const pattern = rawValue2.split('\n')[0].trim(); 
                
                if (!pattern.includes('____') || optionsArray.length < 2) { 
                    MessageBox.show("å¥å‹å¿…é ˆåŒ…å« '____' ä¸”é¸é …è‡³å°‘å…©å€‹ã€‚", true); 
                    return; 
                }
                
                const answer = optionsArray[0]; 
                
                entriesToAdd.push({ id: crypto.randomUUID(), pattern: pattern.toUpperCase(), options: optionsArray, answer: answer });

            } else {
                // éŠæˆ² 1, 3, 5: æ¬„ä½ 1 (ä¸»å€¼) èˆ‡ æ¬„ä½ 2 (é…å°å€¼) æŒ‰è¡Œé…å°
                const lines1 = rawValue1.split('\n').map(line => line.trim()).filter(line => line.length > 0);
                const lines2 = rawValue2.split('\n').map(line => line.trim()).filter(line => line.length > 0);
                
                const count = Math.min(lines1.length, lines2.length);

                if (lines1.length !== lines2.length && count > 0) {
                     // è™•ç†è¡Œæ•¸ä¸åŒ¹é…çš„éŒ¯èª¤ï¼Œä½†ä»è™•ç†åŒ¹é…çš„è¡Œ
                     errorCount += Math.abs(lines1.length - lines2.length);
                     successMessage += `(æ³¨æ„: æ¬„ä½è¡Œæ•¸ä¸åŒ¹é…ï¼Œåƒ…è™•ç†äº† ${count} çµ„) `;
                } else if (count === 0) {
                    MessageBox.show("æ²’æœ‰åµæ¸¬åˆ°æœ‰æ•ˆè¼¸å…¥ã€‚", true);
                    return;
                }
                
                for (let i = 0; i < count; i++) {
                    const value1 = lines1[i]; // ä¸»å€¼ (Word/Verb/Statement)
                    const value2 = lines2[i]; // é…å°å€¼ (Image/Emoji/Answer)

                    let newEntry = null;

                    if (gameKey === 'game1') { // Dino Egg: {word, image}
                        if (/^[A-Z\s]+$/.test(value1.toUpperCase()) && value2.length > 0) {
                            newEntry = { id: crypto.randomUUID(), word: value1.toUpperCase(), image: value2 };
                        } else { errorCount++; }
                    } else if (gameKey === 'game3') { // Superhero Action: {verb, image}
                         if (/^[A-Z\s]+$/.test(value1.toUpperCase()) && value2.length > 0) {
                             newEntry = { id: crypto.randomUUID(), verb: value1.toUpperCase(), image: value2 };
                        } else { errorCount++; }
                    } else if (gameKey === 'game5') { // Who's Lying?: {statement, answer}
                         const g5_answer = value2.toUpperCase();
                         if ((g5_answer === 'TRUE' || g5_answer === 'FALSE') && value1.length > 0) {
                             newEntry = { id: crypto.randomUUID(), statement: value1, answer: g5_answer };
                        } else { errorCount++; }
                    }

                    if (newEntry) {
                         entriesToAdd.push(newEntry);
                    } else {
                        errorCount++;
                    }
                }
            }


            // æœ€çµ‚å„²å­˜
            let addedCount = 0;
            entriesToAdd.forEach(newEntry => {
                // æª¢æŸ¥æ˜¯å¦é‡è¤‡
                const isDuplicate = wordList.some(item => {
                    if (gameKey === 'game4') return item.pattern === newEntry.pattern;
                    if (gameKey === 'game5') return item.statement === newEntry.statement;
                    if (gameKey === 'game3') return item.verb === newEntry.verb;
                    return item.word === newEntry.word;
                });

                if (!isDuplicate) {
                    wordList.push(newEntry);
                    addedCount++;
                }
            });


            // åé¥‹
            saveWordsToLocal();
            input1.value = '';
            input2.value = ''; 

            if (addedCount > 0) {
                let finalMessage = `æˆåŠŸæ–°å¢ ${addedCount} å€‹é …ç›®ã€‚` + successMessage;
                if (errorCount > 0) {
                    finalMessage += ` (æœ‰ ${errorCount} å€‹é …ç›®æ ¼å¼ä¸æ­£ç¢ºæˆ–è¢«å¿½ç•¥)`;
                }
                MessageBox.show(finalMessage, false);
            } else if (errorCount > 0) {
                MessageBox.show(`æ‰€æœ‰é …ç›®çš†æ–°å¢å¤±æ•—æˆ–æ ¼å¼ä¸æ­£ç¢ºã€‚è«‹æª¢æŸ¥è¼¸å…¥ã€‚`, true);
            } else {
                MessageBox.show("æ²’æœ‰æ–°å¢ä»»ä½•é …ç›® (å¯èƒ½æ‰€æœ‰è¼¸å…¥éƒ½é‡è¤‡æˆ–ç‚ºç©º)ã€‚", true);
            }

            renderWordAdmin();
        }

        function deleteWord(id) {
            const gameKey = state.admin_currentGameKey;
            
            const initialLength = localCustomWords[gameKey].length;
            localCustomWords[gameKey] = localCustomWords[gameKey].filter(item => item.id !== id);

            if (localCustomWords[gameKey].length < initialLength) {
                saveWordsToLocal();
                MessageBox.show("é …ç›®åˆªé™¤æˆåŠŸï¼", false);
            } else {
                 MessageBox.show("é …ç›®åˆªé™¤å¤±æ•—ï¼Œæ‰¾ä¸åˆ°è©² IDã€‚", true);
            }
            
            renderWordAdmin();
        }

        function renderWordAdmin() {
            const container = document.getElementById('game-content');
            if (currentGame !== 'admin') return;
            
            const gameKey = state.admin_currentGameKey;
            const currentList = localCustomWords[gameKey] || [];
            
            const config = {
                game1: { title: 'Dino Egg Match (è©å½™/åœ–ç‰‡)', input1: 'è©å½™ (e.g., DINOSAUR)', input2: 'åœ–ç‰‡/Emoji (e.g., ğŸ¦–)', renderer: (item) => `${item.word} / ${item.image}` },
                game2: { title: 'Robot Puzzle (æ‹¼å¯«å–®å­—)', input1: 'å–®å­— (e.g., ROBOT)', input2: 'N/A', renderer: (item) => `${item.word}` },
                game3: { title: 'Superhero Action (å‹•ä½œ/åœ–ç¤º)', input1: 'å‹•ä½œ (e.g., JUMP)', input2: 'åœ–ç¤º/Emoji (e.g., â¬†ï¸)', renderer: (item) => `${item.verb} / ${item.image}` },
                game4: { title: 'Grammar Parking Lot (å¥å‹/é¸é …)', input1: 'é¸é … (é€—è™Ÿåˆ†éš”, ç¬¬ä¸€å€‹ç‚ºç­”æ¡ˆ e.g., IS, AM, ARE)', input2: 'å¥å‹ (å¿…é ˆåŒ…å« ____ e.g., HE ____ MY FRIEND)', renderer: (item) => `${item.pattern.replace('____', `(${item.answer})`)} | Options: ${item.options.join(', ')}` },
                game5: { title: 'Who\'s Lying? (äº‹å¯¦/åˆ¤æ–·)', input1: 'äº‹å¯¦çŸ­å¥ (e.g., The sky is red.)', input2: 'æ­£ç¢ºç­”æ¡ˆ (TRUE/FALSE)', renderer: (item) => `[${item.answer}] ${item.statement}` },
            };
            
            const currentConfig = config[gameKey];
            
            // ç²å–ç•¶å‰å–®å­—åˆ—è¡¨
            const wordListHtml = currentList.map((item, index) => `
                <li class="flex justify-between items-center p-3 bg-white rounded-lg shadow-sm mb-2 border-l-4 border-primary-pink">
                    <span class="text-lg font-bold text-gray-800">${index + 1}. ${currentConfig.renderer(item)}</span>
                    <button onclick="deleteWord('${item.id}')" class="text-red-500 hover:text-red-700 font-bold p-1 rounded-full bg-red-100 transition duration-150">
                        ğŸ—‘ï¸ åˆªé™¤
                    </button>
                </li>
            `).join('');

            // --- è¼¸å…¥æ¡†æ¸²æŸ“é‚è¼¯ ---
            const isSingleInput = currentConfig.input2 === 'N/A'; // Game 2
            
            const inputHelpText = isSingleInput
                ? `è«‹åœ¨ä¸‹æ–¹è¼¸å…¥å€è¼¸å…¥ï¼Œæ¯è¡Œä¸€å€‹å–®å­—ã€‚`
                : gameKey === 'game4'
                    ? `ã€æ¬„ä½ 1ã€‘è¼¸å…¥æ‰€æœ‰é¸é … (é€—è™Ÿåˆ†éš”)ï¼Œã€æ¬„ä½ 2ã€‘è¼¸å…¥å¸¶æœ‰ '____' çš„å¥å‹ã€‚å»ºè­°ä¸€æ¬¡åªæ–°å¢ä¸€çµ„ï¼Œä»¥ç¢ºä¿è³‡æ–™æ­£ç¢ºã€‚`
                    : `è«‹åœ¨å…©å€‹æ¬„ä½ä¸­è¼¸å…¥å…§å®¹ï¼Œä¸¦ç¢ºä¿å®ƒå€‘æ˜¯ã€ŒæŒ‰è¡Œã€å°é½Šçš„ï¼Œç³»çµ±æœƒå°‡ç¬¬ N è¡Œçš„æ¬„ä½ 1 å’Œæ¬„ä½ 2 è¦–ç‚ºä¸€çµ„ã€‚`;

            const input1Placeholder = isSingleInput
                ? currentConfig.input1 + ' (æ¯è¡Œä¸€å€‹)'
                : currentConfig.input1;


            const inputHtml = `
                <div class="space-y-3 mb-4">
                    <p class="text-sm text-gray-600 mb-2">${inputHelpText}</p>

                    <div class="flex ${isSingleInput ? '' : 'space-x-4'}">
                        <!-- æ¬„ä½ 1 -->
                        <div class="${isSingleInput ? 'w-full' : 'w-1/2'}">
                            <label for="new-word-input-1" class="block text-sm font-semibold text-gray-800">æ¬„ä½ 1: ${currentConfig.input1}</label>
                            <textarea id="new-word-input-1" placeholder="${input1Placeholder}" rows="5"
                                    class="w-full p-3 border-2 border-gray-300 rounded-lg focus:ring-secondary-blue focus:border-secondary-blue ${gameKey === 'game2' ? 'uppercase' : ''}"></textarea>
                        </div>
                        
                        <!-- æ¬„ä½ 2 (åªæœ‰é…å°éŠæˆ²é¡¯ç¤º) -->
                        ${!isSingleInput ? 
                            `<div class="w-1/2">
                                <label for="new-word-input-2" class="block text-sm font-semibold text-gray-800">æ¬„ä½ 2: ${currentConfig.input2}</label>
                                <textarea id="new-word-input-2" placeholder="${currentConfig.input2}" rows="5"
                                    class="w-full p-3 border-2 border-gray-300 rounded-lg focus:ring-secondary-blue focus:border-secondary-blue ${gameKey === 'game4' ? 'uppercase' : ''}"></textarea>
                             </div>`
                            : `<input type="hidden" id="new-word-input-2" value="">`}
                    </div>
                </div>
            `;
            // --- çµæŸè¼¸å…¥æ¡†æ¸²æŸ“é‚è¼¯ ---


            container.innerHTML = `
                <section class="w-full bg-primary-pink p-4 rounded-xl shadow-inner border-b-8 border-pink-600">
                    <h2 class="text-xl md:text-3xl font-bold text-white mb-2 text-center">âš™ï¸ å–®å­—ç®¡ç†å¾Œå° (çµ±ä¸€æ§åˆ¶é¢æ¿)</h2>
                    <p class="text-center text-pink-100">ğŸ’¡ é€™è£¡çš„å–®å­—åƒ…å„²å­˜åœ¨æ‚¨ç•¶å‰çš„ç€è¦½å™¨ä¸­ï¼Œä¸¦ä¾›å°æ‡‰çš„éŠæˆ²ä½¿ç”¨ã€‚</p>
                </section>
                
                <div class="p-6 bg-keyboard-bg rounded-xl shadow-md border-b-4 border-accent-yellow">
                    <label for="game-selector" class="block text-lg font-semibold text-gray-800 mb-2">é¸æ“‡è¦ç®¡ç†çš„éŠæˆ²å–®å­—åº«</label>
                    <select id="game-selector" onchange="changeAdminTarget(this.value)" 
                            class="w-full p-3 border-2 border-gray-300 rounded-lg bg-white text-xl font-bold focus:ring-secondary-blue focus:border-secondary-blue mb-4">
                        ${Object.keys(config).map(key => `<option value="${key}" ${gameKey === key ? 'selected' : ''}>${config[key].title}</option>`).join('')}
                    </select>
                    
                    <h3 class="text-xl font-bold text-gray-800 mb-4">æ–°å¢é …ç›®åˆ° **${currentConfig.title}**</h3>
                    
                    ${inputHtml}

                    <button onclick="addWord()" class="w-full bg-secondary-blue hover:bg-blue-400 text-blue-900 font-bold py-3 px-6 rounded-lg shadow-cute transition duration-150">
                        â• æ‰¹é‡æ–°å¢
                    </button>
                    
                    ${gameKey === 'game1' && currentList.length < 4 ? `<p class="text-red-500 mt-2">â— æé¾è›‹éŠæˆ²éœ€è¦è‡³å°‘ 4 çµ„é…å°æ‰èƒ½é–‹å§‹ã€‚</p>` : ''}
                    ${gameKey === 'game2' && currentList.length === 0 ? `<p class="text-red-500 mt-2">â— å­—æ¯æ‹¼åœ–éŠæˆ²éœ€è¦å–®å­—æ‰èƒ½é–‹å§‹ã€‚</p>` : ''}
                </div>

                <div class="p-6 bg-white rounded-xl shadow-md border-2 border-gray-200">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">
                        ${currentConfig.title} è‡ªè¨‚åˆ—è¡¨ (${currentList.length} å€‹)
                    </h3>
                    <ul class="max-h-80 overflow-y-auto">
                        ${currentList.length > 0 ? wordListHtml : '<p class="text-gray-500 text-center py-4">ç›®å‰æ²’æœ‰è‡ªè¨‚é …ç›®ã€‚å¦‚æœåˆ—è¡¨ç‚ºç©ºï¼ŒéŠæˆ²å°‡ä½¿ç”¨å…§å»ºé …ç›®ã€‚</p>'}
                    </ul>
                </div>
            `;
        }
    </script>
</body>
</html>
